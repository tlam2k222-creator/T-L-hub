--[[ 
    TLAM HUB - V12 PRO (RE-ORDERED SLIDERS)
    - UI: Đẩy 2 thanh Slider xuống dưới cùng các nút chức năng.
    - Design: Bo tròn cực mạnh, giao diện tối giản.
    - Sync: ESP dính chặt theo Aim 0.7.
]]

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

-- BIẾN HỆ THỐNG
local aimbotEnabled, espEnabled, showPov = false, false, false
local smartCheck = true 
local aimMode = "OnAttack"
local fovRadius, currentSpeed = 180, 16
local STICKY_SNAP_SPEED = 0.7 

-- 1. FOV CIRCLE
local fovCircle = Drawing.new("Circle")
fovCircle.Thickness = 1; fovCircle.NumSides = 100; fovCircle.Radius = fovRadius
fovCircle.Visible = false; fovCircle.Color = Color3.new(1, 1, 1); fovCircle.Transparency = 0.8

-- 2. HỆ THỐNG ESP SYNC
local playerEsp = {}
local function isTarget(p) return not smartCheck or (p.Team ~= LocalPlayer.Team) end

local function updateEsp()
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            local char = p.Character
            if espEnabled and char and char:FindFirstChild("HumanoidRootPart") and char:FindFirstChild("Head") and char.Humanoid.Health > 0 and isTarget(p) then
                if not playerEsp[p] then 
                    playerEsp[p] = { Tracer = Drawing.new("Line"), Corners = {} }
                    for i = 1, 8 do 
                        local l = Drawing.new("Line"); l.Thickness = 1.2; l.Color = Color3.new(1, 1, 1); table.insert(playerEsp[p].Corners, l)
                    end
                end
                local root = char.HumanoidRootPart
                local pos, on = Camera:WorldToViewportPoint(root.Position)
                if on then
                    local headPos = Camera:WorldToViewportPoint(char.Head.Position + Vector3.new(0, 0.5, 0))
                    local legPos = Camera:WorldToViewportPoint(root.Position - Vector3.new(0, 3, 0))
                    local h, w = math.abs(headPos.Y - legPos.Y), math.abs(headPos.Y - legPos.Y) / 1.5
                    local x, y = pos.X - w/2, pos.Y - h/2
                    local cl = w/4
                    local e = playerEsp[p]
                    e.Tracer.Visible = true; e.Tracer.From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y); e.Tracer.To = Vector2.new(pos.X, y + h)
                    for i=1,8 do e.Corners[i].Visible = true end
                    e.Corners[1].From = Vector2.new(x, y); e.Corners[1].To = Vector2.new(x + cl, y)
                    e.Corners[2].From = Vector2.new(x, y); e.Corners[2].To = Vector2.new(x, y + cl)
                    e.Corners[3].From = Vector2.new(x + w, y); e.Corners[3].To = Vector2.new(x + w - cl, y)
                    e.Corners[4].From = Vector2.new(x + w, y); e.Corners[4].To = Vector2.new(x + w, y + cl)
                    e.Corners[5].From = Vector2.new(x, y + h); e.Corners[5].To = Vector2.new(x + cl, y + h)
                    e.Corners[6].From = Vector2.new(x, y + h); e.Corners[6].To = Vector2.new(x, y + h - cl)
                    e.Corners[7].From = Vector2.new(x + w, y + h); e.Corners[7].To = Vector2.new(x + w - cl, y + h)
                    e.Corners[8].From = Vector2.new(x + w, y + h); e.Corners[8].To = Vector2.new(x + w, y + h - cl)
                else
                    playerEsp[p].Tracer.Visible = false; for i=1,8 do playerEsp[p].Corners[i].Visible = false end
                end
            elseif playerEsp[p] then
                playerEsp[p].Tracer.Visible = false; for i=1,8 do playerEsp[p].Corners[i].Visible = false end
            end
        end
    end
end

-- 3. GIAO DIỆN (ĐÃ SẮP XẾP LẠI THỨ TỰ)
local sg = Instance.new("ScreenGui")
sg.Name = "TLAM_V12_PRO"
pcall(function() sg.Parent = CoreGui end)
if not sg.Parent then sg.Parent = LocalPlayer:WaitForChild("PlayerGui") end

local main = Instance.new("Frame", sg)
main.Size = UDim2.new(0, 155, 0, 265)
main.Position = UDim2.new(0.5, 0, 0.5, 0); main.AnchorPoint = Vector2.new(0.5, 0.5)
main.BackgroundColor3 = Color3.fromRGB(12, 12, 12); main.Active = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 15)
local mStroke = Instance.new("UIStroke", main); mStroke.Color = Color3.new(1, 1, 1); mStroke.Thickness = 1.2

local titleBar = Instance.new("Frame", main)
titleBar.Size = UDim2.new(1, 0, 0, 32); titleBar.BackgroundTransparency = 1
local titleText = Instance.new("TextLabel", titleBar)
titleText.Size = UDim2.new(1, 0, 1, 0); titleText.Text = "TLAM HUB"; titleText.TextColor3 = Color3.new(1,1,1); titleText.Font = "GothamBold"; titleText.TextSize = 11; titleText.BackgroundTransparency = 1

local minBtn = Instance.new("TextButton", titleBar); minBtn.Size = UDim2.new(0,25,0,25); minBtn.Position = UDim2.new(0,8,0,3); minBtn.Text = "-"; minBtn.TextColor3 = Color3.new(1,1,1); minBtn.BackgroundTransparency = 1; minBtn.TextSize = 22
local clsBtn = Instance.new("TextButton", titleBar); clsBtn.Size = UDim2.new(0,25,0,25); clsBtn.Position = UDim2.new(1,-33,0,3); clsBtn.Text = "X"; clsBtn.TextColor3 = Color3.new(1,1,1); clsBtn.BackgroundTransparency = 1; clsBtn.TextSize = 12

local menuContent = Instance.new("Frame", main)
menuContent.Size = UDim2.new(1, 0, 1, -35); menuContent.Position = UDim2.new(0, 0, 0, 35); menuContent.BackgroundTransparency = 1
local layout = Instance.new("UIListLayout", menuContent)
layout.Padding = UDim.new(0, 4); layout.HorizontalAlignment = Enum.HorizontalAlignment.Center

local function makeBtn(txt, start, cb)
    local b = Instance.new("TextButton", menuContent)
    b.Size = UDim2.new(0.9, 0, 0, 22); b.Font = "GothamBold"; b.TextSize = 9; b.TextColor3 = Color3.new(1, 1, 1)
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 10)
    local function v(val) b.Text = txt .. (val and ": ON" or ": OFF"); b.BackgroundColor3 = val and Color3.fromRGB(60, 60, 60) or Color3.fromRGB(28, 28, 28) end
    v(start); b.MouseButton1Click:Connect(function() v(cb()) end)
end

-- PHẦN 1: CÁC NÚT BẬT TẮT (NẰM TRÊN)
makeBtn("AIMBOT", aimbotEnabled, function() aimbotEnabled = not aimbotEnabled; return aimbotEnabled end)
makeBtn("ESP PLAYER", espEnabled, function() espEnabled = not espEnabled; return espEnabled end)
makeBtn("POV CIRCLE", showPov, function() showPov = not showPov; return showPov end)
makeBtn("TEAM CHECK", smartCheck, function() smartCheck = not smartCheck; return smartCheck end)

local modeBtn = Instance.new("TextButton", menuContent)
modeBtn.Size = UDim2.new(0.9, 0, 0, 22); modeBtn.BackgroundColor3 = Color3.fromRGB(35, 35, 35); modeBtn.TextColor3 = Color3.new(1, 1, 1); modeBtn.Text = "MODE: ATTACK"; modeBtn.Font = "GothamBold"; modeBtn.TextSize = 9; Instance.new("UICorner", modeBtn).CornerRadius = UDim.new(0, 10)
modeBtn.MouseButton1Click:Connect(function() aimMode = (aimMode == "OnAttack" and "Always" or "OnAttack"); modeBtn.Text = "MODE: " .. (aimMode == "OnAttack" and "ATTACK" or "ALWAYS") end)

-- PHẦN 2: THANH TRƯỢT (NẰM DƯỚI CÙNG)
local function makeSlider(label, min, max, def, cb)
    local f = Instance.new("Frame", menuContent); f.Size = UDim2.new(0.9, 0, 0, 32); f.BackgroundTransparency = 1
    local t = Instance.new("TextLabel", f); t.Size = UDim2.new(1, 0, 0, 10); t.Text = label..": "..def; t.TextColor3 = Color3.new(1,1,1); t.BackgroundTransparency = 1; t.TextSize = 8; t.Font = "Gotham"
    local b = Instance.new("Frame", f); b.Size = UDim2.new(1, 0, 0, 3); b.Position = UDim2.new(0, 0, 0, 18); b.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    Instance.new("UICorner", b).CornerRadius = UDim.new(1, 0)
    local fill = Instance.new("Frame", b); fill.Size = UDim2.new((def-min)/(max-min), 0, 1, 0); fill.BackgroundColor3 = Color3.new(1, 1, 1)
    Instance.new("UICorner", fill).CornerRadius = UDim.new(1, 0)
    local knob = Instance.new("Frame", fill); knob.Size = UDim2.new(0, 10, 0, 10); knob.Position = UDim2.new(1, 0, 0.5, 0); knob.AnchorPoint = Vector2.new(0.5, 0.5); knob.BackgroundColor3 = Color3.new(1, 1, 1)
    Instance.new("UICorner", knob).CornerRadius = UDim.new(1, 0)
    local dragging = false
    local function update()
        local p = math.clamp((UIS:GetMouseLocation().X - b.AbsolutePosition.X) / b.AbsoluteSize.X, 0, 1)
        fill.Size = UDim2.new(p, 0, 1, 0); local val = math.floor(min + (p * (max-min))); t.Text = label..": "..val; cb(val)
    end
    f.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then dragging = true; update() end end)
    UIS.InputChanged:Connect(function(i) if dragging and (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) then update() end end)
    UIS.InputEnded:Connect(function() dragging = false end)
end

makeSlider("POV RADIUS", 10, 600, 180, function(v) fovRadius = v end)
makeSlider("WALK SPEED", 16, 250, 16, function(v) currentSpeed = v end)

-- 4. LOGIC CORE
minBtn.MouseButton1Click:Connect(function()
    menuContent.Visible = not menuContent.Visible
    main:TweenSize(menuContent.Visible and UDim2.new(0, 155, 0, 265) or UDim2.new(0, 155, 0, 32), "Out", "Quad", 0.15, true)
end)
clsBtn.MouseButton1Click:Connect(function() sg:Destroy(); fovCircle:Remove() end)

RunService.RenderStepped:Connect(function()
    if aimbotEnabled then
        local isShooting = UIS:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) or UIS:IsKeyDown(Enum.KeyCode.ButtonR2)
        if (aimMode == "OnAttack" and isShooting) or aimMode == "Always" then
            local target, dist = nil, fovRadius
            for _, p in pairs(Players:GetPlayers()) do
                if p ~= LocalPlayer and isTarget(p) and p.Character and p.Character:FindFirstChild("Head") and p.Character.Humanoid.Health > 0 then
                    local pos, on = Camera:WorldToViewportPoint(p.Character.Head.Position)
                    if on then
                        local mag = (Vector2.new(pos.X, pos.Y) - Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).Magnitude
                        if mag < dist then dist = mag; target = p.Character.Head end
                    end
                end
            end
            if target then Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, target.Position), STICKY_SNAP_SPEED) end
        end
    end
    updateEsp()
    if fovCircle then fovCircle.Visible = showPov; fovCircle.Radius = fovRadius; fovCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2) end
    pcall(function() LocalPlayer.Character.Humanoid.WalkSpeed = currentSpeed end)
end)

-- DRAG
local dToggle, dStart, sPos
titleBar.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then dToggle = true; dStart = i.Position; sPos = main.Position end end)
UIS.InputChanged:Connect(function(i) if dToggle and (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) then 
    local delta = i.Position - dStart
    main.Position = UDim2.new(sPos.X.Scale, sPos.X.Offset + delta.X, sPos.Y.Scale, sPos.Y.Offset + delta.Y)
end end)
UIS.InputEnded:Connect(function() dToggle = false end)
